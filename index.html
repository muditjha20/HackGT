
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bystander Coach VR Training</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/speech-recognition-polyfill@0.1.4/dist/speech-recognition.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="loadingScreen">
        <div>Loading Bystander Coach VR Training</div>
        <div class="pulse">Please wait...</div>
    </div>
    
    <canvas id="exportCanvas" width="800" height="600"></canvas>
    
    <button id="micPermission">Enable Microphone</button>
    <div id="micStatus">Microphone: Disabled</div>
    <div id="hint">Point at buttons with your controller and click to select responses</div>
    
    <a-scene 
        background="color: #2c3e50" 
        webxr="requiredFeatures: local-floor; optionalFeatures: hand-tracking"
        xr-mode-ui="enabled: true"
        loading-screen="enabled: false">
        
        <!-- Camera Rig -->
        <a-entity id="rig" movement-controls="speed: 0.5">
            <a-camera id="camera" position="0 1.6 0">
                <a-cursor 
                    id="gazeCursor"
                    object3D="position: 0 0 -1"
                    raycaster="objects: .clickable"
                    animation__click="property: scale; startEvents: click; from: 0.1 0.1 0.1; to: 1 1 1; dur: 150">
                </a-cursor>
            </a-camera>
            
            <!-- Left controller -->
            <a-entity 
                laser-controls="hand: left" 
                raycaster="objects: .clickable"
                line="color: #3498db; opacity: 0.7">
                <a-entity 
                    class="hover-indicator"
                    geometry="primitive: sphere; radius: 0.015"
                    material="color: #f1c40f; shader: flat"
                    visible="false">
                </a-entity>
            </a-entity>
            
            <!-- Right controller -->
            <a-entity 
                laser-controls="hand: right" 
                raycaster="objects: .clickable"
                line="color: #3498db; opacity: 0.7">
                <a-entity 
                    class="hover-indicator"
                    geometry="primitive: sphere; radius: 0.015"
                    material="color: #f1c40f; shader: flat"
                    visible="false">
                </a-entity>
            </a-entity>
        </a-entity>
        
        <!-- Lighting -->
        <a-light type="ambient" color="#BBB" intensity="0.6"></a-light>
        <a-light type="directional" color="#FFF" intensity="0.9" position="-1 3 1" cast-shadow="true"></a-light>
        <a-light type="point" color="#e67e22" intensity="0.5" position="2 3 -3"></a-light>
        
        <!-- Environment: Bus Interior -->
        <a-entity id="busEnvironment">
            <!-- Bus floor -->
            <a-plane 
                position="0 0 0" 
                rotation="-90 0 0" 
                width="10" 
                height="20" 
                color="#7f8c8d" 
                shadow="receive: true"
                roughness="0.8">
            </a-plane>
            
            <!-- Bus ceiling -->
            <a-plane 
                position="0 3.5 0" 
                rotation="90 0 0" 
                width="10" 
                height="20" 
                color="#34495e" 
                roughness="0.7">
            </a-plane>
            
            <!-- Bus left wall -->
            <a-plane 
                position="-5 1.75 0" 
                rotation="0 90 0" 
                width="7" 
                height="3.5" 
                color="#2c3e50" 
                roughness="0.6">
            </a-plane>
            
            <!-- Bus right wall -->
            <a-plane 
                position="5 1.75 0" 
                rotation="0 -90 0" 
                width="7" 
                height="3.5" 
                color="#2c3e50" 
                roughness="0.6">
            </a-plane>
            
            <!-- Bus back wall -->
            <a-plane 
                position="0 1.75 -10" 
                rotation="0 0 0" 
                width="10" 
                height="3.5" 
                color="#2c3e50" 
                roughness="0.6">
            </a-plane>
            
            <!-- Bus front (with windshield) -->
            <a-plane 
                position="0 1.75 10" 
                rotation="0 180 0" 
                width="10" 
                height="3.5" 
                color="#2c3e50" 
                roughness="0.6">
                <!-- Windshield -->
                <a-plane 
                    position="0 0.5 0.1" 
                    rotation="0 0 0" 
                    width="6" 
                    height="1.5" 
                    color="#3498db" 
                    opacity="0.3">
                </a-plane>
            </a-plane>
            
            <!-- Bus seats -->
            <a-entity id="busSeats">
                <!-- Driver seat -->
                <a-box 
                    position="-2 0.5 8" 
                    width="1" 
                    height="1" 
                    depth="1" 
                    color="#c0392b"
                    roughness="0.7">
                </a-box>
                
                <!-- Passenger seats (two rows) -->
                <a-box 
                    position="-2 0.5 5" 
                    width="1" 
                    height="1" 
                    depth="1" 
                    color="#16a085"
                    roughness="0.7">
                </a-box>
                
                <a-box 
                    position="2 0.5 5" 
                    width="1" 
                    height="1" 
                    depth="1" 
                    color="#16a085"
                    roughness="0.7">
                </a-box>
                
                <a-box 
                    position="-2 0.5 2" 
                    width="1" 
                    height="1" 
                    depth="1" 
                    color="#16a085"
                    roughness="0.7">
                </a-box>
                
                <a-box 
                    position="2 0.5 2" 
                    width="1" 
                    height="1" 
                    depth="1" 
                    color="#16a085"
                    roughness="0.7">
                </a-box>
            </a-entity>
            
            <!-- Bus details -->
            <a-entity id="busDetails">
                <!-- Handrails -->
                <a-cylinder 
                    position="-3 1.5 0" 
                    radius="0.03" 
                    height="3" 
                    color="#e74c3c"
                    rotation="0 0 90">
                </a-cylinder>
                
                <a-cylinder 
                    position="3 1.5 0" 
                    radius="0.03" 
                    height="3" 
                    color="#e74c3c"
                    rotation="0 0 90">
                </a-cylinder>
                
                <!-- Overhead luggage racks -->
                <a-box 
                    position="0 2.8 0" 
                    width="8" 
                    height="0.1" 
                    depth="18" 
                    color="#95a5a6"
                    roughness="0.8">
                </a-box>
            </a-entity>
        </a-entity>
        
        <!-- NPCs: Angry Passenger and Bus Driver -->
        <a-entity id="npcs">
            <!-- Angry Passenger -->
            <a-entity id="angryPassenger" position="1 0 6">
                <!-- Body -->
                <a-cylinder 
                    position="0 0.9 0" 
                    radius="0.2" 
                    height="1.8" 
                    color="#e74c3c"
                    roughness="0.6">
                </a-cylinder>
                
                <!-- Head -->
                <a-sphere 
                    position="0 1.8 0" 
                    radius="0.25" 
                    color="#f39c12">
                </a-sphere>
                
                <!-- Arms -->
                <a-cylinder 
                    position="-0.3 1.3 0" 
                    radius="0.05" 
                    height="0.6" 
                    color="#e74c3c"
                    rotation="0 0 45">
                </a-cylinder>
                
                <a-cylinder 
                    position="0.3 1.3 0" 
                    radius="0.05" 
                    height="0.6" 
                    color="#e74c3c"
                    rotation="0 0 -45">
                </a-cylinder>
                
                <!-- Animation: Angry gestures -->
                <a-animation 
                    attribute="rotation" 
                    dur="1000" 
                    from="0 0 -5" 
                    to="0 0 5" 
                    direction="alternate" 
                    repeat="indefinite"
                    easing="easeInOutSine">
                </a-animation>
                
                <!-- Speech bubble (initially hidden) -->
                <a-entity id="passengerBubble" position="0 2.5 0" visible="false">
                    <a-plane 
                        width="1.5" 
                        height="0.5" 
                        color="#34495e" 
                        opacity="0.9"
                        position="0 0 0">
                    </a-plane>
                    <a-text 
                        id="passengerText"
                        value="" 
                        width="1.3"
                        align="center" 
                        wrap-count="20"
                        color="white" 
                        position="0 0 0.01"
                        font="https://cdn.aframe.io/fonts/mozillavr.fnt">
                    </a-text>
                </a-entity>
            </a-entity>
            
            <!-- Bus Driver -->
            <a-entity id="busDriver" position="-2 0 8">
                <!-- Body -->
                <a-cylinder 
                    position="0 0.9 0" 
                    radius="0.2" 
                    height="1.8" 
                    color="#3498db"
                    roughness="0.6">
                </a-cylinder>
                
                <!-- Head -->
                <a-sphere 
                    position="0 1.8 0" 
                    radius="0.25" 
                    color="#f39c12">
                </a-sphere>
                
                <!-- Arms on steering wheel -->
                <a-cylinder 
                    position="0.15 1.4 0.2" 
                    radius="0.05" 
                    height="0.4" 
                    color="#3498db"
                    rotation="30 0 0">
                </a-cylinder>
                
                <!-- Animation: Nervous head shaking -->
                <a-animation 
                    attribute="rotation" 
                    dur="2000" 
                    from="0 0 -2" 
                    to="0 0 2" 
                    direction="alternate" 
                    repeat="indefinite"
                    easing="easeInOutSine">
                </a-animation>
                
                <!-- Steering wheel -->
                <a-torus 
                    position="0.3 1.5 0.3" 
                    radius="0.2" 
                    arc="360" 
                    color="#7f8c8d"
                    rotation="0 0 90">
                </a-torus>
                
                <!-- Speech bubble (initially hidden) -->
                <a-entity id="driverBubble" position="0 2.5 0" visible="false">
                    <a-plane 
                        width="1.5" 
                        height="0.5" 
                        color="#34495e" 
                        opacity="0.9"
                        position="0 0 0">
                    </a-plane>
                    <a-text 
                        id="driverText"
                        value="" 
                        width="1.3"
                        align="center" 
                        wrap-count="20"
                        color="white" 
                        position="0 0 0.01"
                        font="https://cdn.aframe.io/fonts/mozillavr.fnt">
                    </a-text>
                </a-entity>
            </a-entity>
        </a-entity>
        
        <!-- UI Panel -->
        <a-entity id="uiPanel" position="0 1.5 -1.5">
            <!-- Panel background with subtle animation -->
            <a-plane 
                id="panelBg"
                width="2" 
                height="1.5" 
                color="#2c3e50" 
                opacity="0.95"
                position="0 0 0"
                animation="property: position; from: 0 1.8 -1.5; to: 0 1.5 -1.5; dur: 1000; easing: easeOutBack">
            </a-plane>
            
            <!-- Panel frame -->
            <a-plane 
                width="2.05" 
                height="1.55" 
                color="#3498db" 
                opacity="0.8"
                position="0 0 -0.01"
                wireframe="true"
                wireframe-linewidth="3">
            </a-plane>
            
            <!-- Subtitle text -->
            <a-text 
                id="subtitle"
                value="Welcome to Bystander Coach" 
                width="1.8"
                align="center" 
                wrap-count="25"
                color="white" 
                position="0 0.5 0.01"
                font="https://cdn.aframe.io/fonts/mozillavr.fnt"
                animation="property: scale; from: 0.5 0.5 0.5; to: 1 1 1; dur: 800; delay: 300">
            </a-text>
            
            <!-- Response buttons -->
            <a-entity id="responseButtons" visible="false">
                <!-- Button 1: Direct -->
                <a-box 
                    class="clickable response-btn"
                    data-choice="Direct"
                    width="1.4" 
                    height="0.25" 
                    depth="0.05"
                    color="#27ae60"
                    position="0 0.1 0.01"
                    event-set__mouseenter="scale: 1.05 1.05 1.05; color: #2ecc71"
                    event-set__mouseleave="scale: 1 1 1; color: #27ae60"
                    animation="property: position; from: 0 -0.5 0.01; to: 0 0.1 0.01; dur: 800; delay: 500">
                    <a-text 
                        value="Direct: Calmly address the situation" 
                        align="center" 
                        color="white" 
                        position="0 0 0.03"
                        width="1.3">
                    </a-text>
                </a-box>
                
                <!-- Button 2: Distract -->
                <a-box 
                    class="clickable response-btn"
                    data-choice="Distract"
                    width="1.4" 
                    height="0.25" 
                    depth="0.05"
                    color="#2980b9"
                    position="0 -0.2 0.01"
                    event-set__mouseenter="scale: 1.05 1.05 1.05; color: #3498db"
                    event-set__mouseleave="scale: 1 1 1; color: #2980b9"
                    animation="property: position; from: 0 -0.5 0.01; to: 0 -0.2 0.01; dur: 800; delay: 600">
                    <a-text 
                        value="Distract: Redirect attention" 
                        align="center" 
                        color="white" 
                        position="0 0 0.03"
                        width="1.3">
                    </a-text>
                </a-box>
                
                <!-- Button 3: Delegate -->
                <a-box 
                    class="clickable response-btn"
                    data-choice="Delegate"
                    width="1.4" 
                    height="0.25" 
                    depth="0.05"
                    color="#e67e22"
                    position="0 -0.5 0.01"
                    event-set__mouseenter="scale: 1.05 1.05 1.05; color: #f39c12"
                    event-set__mouseleave="scale: 1 1 1; color: #e67e22"
                    animation="property: position; from: 0 -0.5 0.01; to: 0 -0.5 0.01; dur: 800; delay: 700">
                    <a-text 
                        value="Delegate: Seek help from authority" 
                        align="center" 
                        color="white" 
                        position="0 0 0.03"
                        width="1.3">
                    </a-text>
                </a-box>
            </a-entity>
            
            <!-- Voice input section -->
            <a-entity id="voiceInputSection" visible="false">
                <a-box 
                    id="speakNowBtn"
                    class="clickable"
                    width="1.4" 
                    height="0.25" 
                    depth="0.05"
                    color="#9b59b6"
                    position="0 -0.8 0.01"
                    event-set__mouseenter="scale: 1.05 1.05 1.05; color: #8e44ad"
                    event-set__mouseleave="scale: 1 1 1; color: #9b59b6"
                    animation="property: position; from: 0 -1.2 0.01; to: 0 -0.8 0.01; dur: 800; delay: 800">
                    <a-text 
                        value="Speak Your Response (Click and hold)" 
                        align="center" 
                        color="white" 
                        position="0 0 0.03"
                        width="1.3">
                    </a-text>
                </a-box>
                
                <!-- Transcript display -->
                <a-text 
                    id="transcript"
                    value="" 
                    width="1.8"
                    align="center" 
                    wrap-count="25"
                    color="#f1c40f" 
                    position="0 -1.1 0.01"
                    font="https://cdn.aframe.io/fonts/mozillavr.fnt">
                </a-text>
            </a-entity>
        </a-entity>
        
        <!-- Feedback Card -->
        <a-entity id="feedbackCard" position="0 1.5 -0.8" scale="0 0 0" visible="false">
            <!-- Card background with animation -->
            <a-plane 
                width="2" 
                height="2" 
                color="#2c3e50" 
                opacity="0.97"
                position="0 0 0"
                animation="property: scale; from: 0 0 0; to: 1 1 1; dur: 1000; easing: easeOutBack">
            </a-plane>
            
            <!-- Card frame -->
            <a-plane 
                width="2.05" 
                height="2.05" 
                color="#3498db" 
                opacity="0.8"
                position="0 0 -0.01"
                wireframe="true"
                wireframe-linewidth="3">
            </a-plane>
            
            <!-- Card title -->
            <a-text 
                value="Training Feedback" 
                width="1.8"
                align="center" 
                color="#f1c40f" 
                position="0 0.8 0.01"
                font="https://cdn.aframe.io/fonts/mozillavr.fnt">
            </a-text>
            
            <!-- Response summary -->
            <a-text 
                id="feedbackResponse"
                value="" 
                width="1.8"
                align="center" 
                wrap-count="25"
                color="#e74c3c" 
                position="0 0.5 0.01"
                font="https://cdn.aframe.io/fonts/mozillavr.fnt">
            </a-text>
            
            <!-- Tone summary -->
            <a-text 
                id="feedbackTone"
                value="" 
                width="1.8"
                align="center" 
                wrap-count="25"
                color="#3498db" 
                position="0 0.3 0.01"
                font="https://cdn.aframe.io/fonts/mozillavr.fnt">
            </a-text>
            
            <!-- What went well -->
            <a-text 
                id="feedbackPositive"
                value="" 
                width="1.8"
                align="center" 
                wrap-count="25"
                color="#27ae60" 
                position="0 0.1 0.01"
                font="https://cdn.aframe.io/fonts/mozillavr.fnt">
            </a-text>
            
            <!-- Suggestion -->
            <a-text 
                id="feedbackSuggestion"
                value="" 
                width="1.8"
                align="center" 
                wrap-count="25"
                color="#e67e22" 
                position="0 -0.1 0.01"
                font="https://cdn.aframe.io/fonts/mozillavr.fnt">
            </a-text>
            
            <!-- Better line suggestion -->
            <a-text 
                id="feedbackBetterLine"
                value="" 
                width="1.8"
                align="center" 
                wrap-count="25"
                color="#9b59b6" 
                position="0 -0.3 0.01"
                font="https://cdn.aframe.io/fonts/mozillavr.fnt">
            </a-text>
            
            <!-- Save Card button -->
            <a-box 
                id="saveCardBtn"
                class="clickable"
                width="0.9" 
                height="0.2" 
                depth="0.05"
                color="#27ae60"
                position="-0.5 -0.7 0.01"
                event-set__mouseenter="scale: 1.05 1.05 1.05; color: #2ecc71"
                event-set__mouseleave="scale: 1 1 1; color: #27ae60">
                <a-text 
                    value="Save Card" 
                    align="center" 
                    color="white" 
                    position="0 0 0.03"
                    width="0.8">
                </a-text>
            </a-box>
            
            <!-- Replay button -->
            <a-box 
                id="replayBtn"
                class="clickable"
                width="0.9" 
                height="0.2" 
                depth="0.05"
                color="#3498db"
                position="0.5 -0.7 0.01"
                event-set__mouseenter="scale: 1.05 1.05 1.05; color: #2980b9"
                event-set__mouseleave="scale: 1 1 1; color: #3498db">
                <a-text 
                    value="Replay"
                    align="center" 
                    color="white" 
                    position="0 0 0.03"
                    width="0.8">
                </a-text>
            </a-box>
        </a-entity>
    </a-scene>

    <script src="script.js"></script>
</body>
</html>
